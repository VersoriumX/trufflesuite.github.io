<!DOCTYPE html>
<html>
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WHT4PS2');</script>
  <!-- End Google Tag Manager -->
  
  <!-- HubSpot Forms -->
  <!--[if lte IE 8]>
    <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
  <![endif]-->
  <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>  <!-- Start of HubSpot Embed Code -->
  <script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/4795067.js"></script>
  <!-- End of HubSpot Embed Code -->  
  <meta charset="utf-8">
  <meta name="description" content="The Truffle suite of tools make dapp development easier and more consistent.">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <!-- Favicon -->
  <link rel="icon" href="/img/favicons/favicon.ico">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Truffle Suite">
  <link rel="icon" sizes="192x192" href="/img/favicons/chrome-touch-icon-192x192.png">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Truffle Suite">
  <link rel="apple-touch-icon" href="/img/favicons/apple-touch-icon.png">

  <!-- Tile icon for Win8/10 (144x144 + tile color) -->
  <meta name="msapplication-TileImage" content="img/favicons/ms-touch-icon-144x144-precomposed.png">
  <meta name="msapplication-TileColor" content="#3372DF">

  <!-- Facebook OpenGraph -->
  <meta property="og:site_name" content="Truffle Suite" />
  <meta property="og:description" content="The Truffle suite of tools make dapp development easier and more consistent." />
  <meta property="og:title" content="Getting Started with Drizzle and React | Tutorials | Truffle Suite" />
  <meta property="og:url" content="https://trufflesuite.com/guides/getting-started-with-drizzle-and-react" />
  <meta property="og:type" content="article" />
  <meta property="og:image" content="https://truffleframework.com/img/favicons/truffle-share.png" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="Truffle Suite" />
  <meta name="twitter:title" content="Getting Started with Drizzle and React | Tutorials | Truffle Suite" />
  <meta name="twitter:description" content="The Truffle suite of tools make dapp development easier and more consistent." />
  <meta name="twitter:creator" content="Truffle Suite" />
  <meta name="twitter:domain" content="trufflesuite.com" />
  <meta name="twitter:image:src" content="https://truffleframework.com/img/favicons/truffle-share.png" />
  
  <meta name="google-site-verification" content="BSgPkMHzw7IxJTpEElNfD8ZZYPzXgOQiTVPzAxAG8-o" />
    
  <title>Getting Started with Drizzle and React | Guides | Truffle Suite</title>

  <link href="https://fonts.googleapis.com/css?family=Grand+Hotel|Open+Sans|Oswald|Varela+Round|Roboto+Condensed|Roboto+Mono" rel="stylesheet">
  <script src="https://kit.fontawesome.com/371f2d7a8a.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/css/index.css">
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WHT4PS2"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->  
    <nav class="navbar navbar-expand-md navbar-dark fixed-top" id="primaryNav">
    <a class="navbar-brand current" href="/">
        <img class="suite-logo" src="/img/truffle-logomark.svg" alt="Truffle Logo" /><span class="d-none d-lg-block">TRUFFLE SUITE</span>
    </a>
  
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  
    <div class="collapse navbar-collapse" id="navbarsExampleDefault">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" id="suiteDropdown" href="#" data-toggle="dropdown">SUITE</a>
  
          <div class="dropdown-menu">
            <a class="text-truffle" href="/teams">
              <img class="suite-logo" src="/img/tt-logomark.svg" alt="Truffle Teams Logo" /><span class="narrow">T</span>RUFFLE TEAMS
            </a>
            <a class="text-truffle" href="/truffle">
              <img class="suite-logo" src="/img/truffle-logomark.svg" alt="Truffle Logo" /><span class="narrow">T</span>RUFFLE
            </a>
            <a class="text-ganache" href="/ganache">
              <img class="suite-logo" src="/img/ganache-logomark.svg" alt="Ganache Logo" />Ganache
            </a>
            <a class="text-drizzle" href="/drizzle">
              <img class="suite-logo" src="/img/drizzle-logomark.svg" alt="Drizzle Logo" />dri<span class="drizzle-z-skew-1">z</span><span class="drizzle-z-skew-2">z</span>le
            </a>
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/docs">DOCS</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/guides">GUIDES</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/tutorial">TUTORIAL</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/boxes">BOXES</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog">BLOG</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/community">COMMUNITY</a>
        </li>
      </ul>
    </div>
  </nav>

  <main class="container container-heading container-narrow">
    <div class="row">
      <div class="col">
        <h1>Getting Started with Drizzle and React</h1>
        <ul class="list-sm-stacker space-icon mb-0">
          <li><i class="far fa-calendar-alt"></i> 2018-08-28&nbsp;&nbsp;&nbsp;</li>
          <li><i class="far fa-user"></i> Adrian Li</li>
        </ul>
      </div>
    </div>
  </main>

  <main class="banner banner-light-cream pt-5 pb-5" role="main">
    <div class="container container-post">
      <div class="row justify-content-center">
        <div class="col">
          <p>Drizzle is the newest member of the Truffle Suite and our first front-end development tool. At its core, <strong>Drizzle</strong> takes care of synchronizing your contract data, transaction data and more from the blockchain to a Redux store. There are also higher-level abstractions on top of the base <code>drizzle</code> library; tools for React compatibility (<a href="/docs/drizzle/react/react-integration"><code>drizzle-react</code></a>) and a set of ready-to-use React components (<a href="/docs/drizzle/react/react-components"><code>drizzle-react-components</code></a>).</p>
<p>We&#39;re going to focus on the lower levels today, taking you through setting up a Truffle project with React and Drizzle from scratch. This way we can gain the best understanding of how Drizzle works under the hood. With this knowledge, you can leverage the full power of Drizzle with any front-end framework of your choosing, or use the higher-level React abstractions with confidence.</p>
<p>This will be a very minimal tutorial focused on setting and getting a simple string stored in a contract. It&#39;s meant for those with a basic knowledge of Truffle, who have some knowledge of JavaScript and React.js, but who are new to using Drizzle.</p>
<p class="alert alert-info">
<i class="far fa-info-circle"></i> <strong>Note</strong>: For Truffle basics, please read through the Truffle <a href="/tutorials/pet-shop">Pet Shop</a> tutorial before proceeding.
</p>

<p>In this tutorial we will be covering:</p>
<ol>
<li>Setting up the development environment</li>
<li>Creating a Truffle project from scratch</li>
<li>Writing the smart contract</li>
<li>Compiling and migrating the smart contract</li>
<li>Testing the smart contract</li>
<li>Creating our React.js project</li>
<li>Wiring up the front-end client</li>
<li>Wire up the React app with Drizzle</li>
<li>Write a component to read from Drizzle</li>
<li>Write a component to write to the smart contract</li>
</ol>

    <h2 class="link-markdown">
      <a class="anchor-target" name="setting-up-the-development-environment"></a>
      <a href="#setting-up-the-development-environment"><i class="fas fa-link"></i></a>
      Setting up the development environment
    </h2>
  <p>There are a few technical requirements before we start. Please install the following:</p>
<ul>
<li><a href="https://nodejs.org/en/">Node.js v8+ LTS and npm</a> (comes with Node)</li>
</ul>

    <h3 class="link-markdown">
      <a class="anchor-target" name="truffle"></a>
      <a href="#truffle"><i class="fas fa-link"></i></a>
      Truffle
    </h3>
  <p>Once we have those installed, we only need one command to install Truffle:</p>
<pre><code class="language-shell">npm install -g truffle</code></pre>
<p>To verify that Truffle is installed properly, type <code>truffle version</code> on a terminal. If you see an error, make sure that your npm modules are added to your path.</p>

    <h3 class="link-markdown">
      <a class="anchor-target" name="create-react-app"></a>
      <a href="#create-react-app"><i class="fas fa-link"></i></a>
      Create-React-App
    </h3>
  <p>Finally, since this is a React.js tutorial, we will be creating our React project with <a href="https://github.com/facebook/create-react-app/">Create-React-App</a>.</p>
<p>You won&#39;t have to do anything if you have NPM version 5.2 or above. You can check your NPM version by running <code>npm --version</code>. If you do not, then you will need to install the tool globally with this command:</p>
<pre><code class="language-shell">npm install -g create-react-app</code></pre>

    <h2 class="link-markdown">
      <a class="anchor-target" name="creating-a-truffle-project"></a>
      <a href="#creating-a-truffle-project"><i class="fas fa-link"></i></a>
      Creating a Truffle project
    </h2>
  <ol>
<li><p>Truffle initializes in the current directory, so first create a directory in your development folder of choice and then move inside it.</p>
<pre><code class="language-shell">mkdir drizzle-react-tutorial
cd drizzle-react-tutorial</code></pre>
</li>
<li><p>Now we&#39;re ready to spawn our empty Truffle project by running the following command:</p>
<pre><code class="language-shell">truffle init</code></pre>
</li>
</ol>
<p>Let&#39;s take a brief look at the directory structure that was just generated.</p>

    <h3 class="link-markdown">
      <a class="anchor-target" name="directory-structure"></a>
      <a href="#directory-structure"><i class="fas fa-link"></i></a>
      Directory structure
    </h3>
  <p>The default Truffle directory structure contains the following:</p>
<ul>
<li><code>contracts/</code>: Contains the <a href="https://solidity.readthedocs.io/">Solidity</a> source files for our smart contracts. There is an important contract in here called <code>Migrations.sol</code>, which we&#39;ll talk about later.</li>
<li><code>migrations/</code>: Truffle uses a migration system to handle smart contract deployments. A migration is an additional special smart contract that keeps track of changes.</li>
<li><code>test/</code>: Contains both JavaScript and Solidity tests for our smart contracts.</li>
<li><code>truffle-config.js</code>: Truffle configuration file.</li>
</ul>

    <h2 class="link-markdown">
      <a class="anchor-target" name="writing-our-smart-contract"></a>
      <a href="#writing-our-smart-contract"><i class="fas fa-link"></i></a>
      Writing our smart contract
    </h2>
  <p>We&#39;ll add a simple smart contract called MyStringStore.</p>
<ol>
<li><p>Create a new file named <code>MyStringStore.sol</code> in the <code>contracts/</code> directory.</p>
</li>
<li><p>Add the following content to the file:</p>
<pre><code class="language-solidity">pragma solidity ^0.5.0;

contract MyStringStore {
  string public myString = &quot;Hello World&quot;;

  function set(string memory x) public {
    myString = x;
  }
}</code></pre>
</li>
</ol>
<p>Since this isn&#39;t a Solidity tutorial, all you need to know about this is:</p>
<ul>
<li>We&#39;ve created a public string variable named <code>myString</code> and initialized it to &quot;Hello World&quot;. This automatically creates a getter (since it&#39;s a public variable) so we don&#39;t have to write one ourselves.</li>
<li>We&#39;ve created a setter method that simply sets the <code>myString</code> variable with whatever string is passed in.</li>
</ul>

    <h2 class="link-markdown">
      <a class="anchor-target" name="launching-a-test-blockchain-with-truffle-develop"></a>
      <a href="#launching-a-test-blockchain-with-truffle-develop"><i class="fas fa-link"></i></a>
      Launching a test blockchain with Truffle Develop
    </h2>
  <p>Before we move ahead, let&#39;s first launch our test blockchain with the Truffle Develop console.</p>
<p>Open up a new terminal, navigate to the project directory, and run the following command:</p>
<pre><code class="language-shell">truffle develop</code></pre>
<p>This will spawn a new blockchain that listens on <code>127.0.0.1:9545</code> by default.</p>

    <h2 class="link-markdown">
      <a class="anchor-target" name="compiling-and-migrating-the-smart-contract"></a>
      <a href="#compiling-and-migrating-the-smart-contract"><i class="fas fa-link"></i></a>
      Compiling and migrating the smart contract
    </h2>
  <p>Now we are ready to compile and migrate our contract.</p>

    <h3 class="link-markdown">
      <a class="anchor-target" name="compilation"></a>
      <a href="#compilation"><i class="fas fa-link"></i></a>
      Compilation
    </h3>
  <p>In the Truffle Develop console, type the following command:</p>
<pre><code class="language-shell">compile</code></pre>
<p class="alert alert-info">
<strong>Note</strong>: If you're on Windows and encountering problems running this command, please see the documentation on [resolving naming conflicts on Windows](/docs/advanced/configuration#resolving-naming-conflicts-on-windows).
</p>

<p>You should see output similar to the following:</p>
<pre><code>Compiling ./contracts/Migrations.sol...
Compiling ./contracts/MyStringStore.sol...
Writing artifacts to ./build/contracts</code></pre>
    <h3 class="link-markdown">
      <a class="anchor-target" name="migration"></a>
      <a href="#migration"><i class="fas fa-link"></i></a>
      Migration
    </h3>
  <p>Now that we&#39;ve successfully compiled our contracts, it&#39;s time to migrate them to the blockchain!</p>
<p class="alert alert-info">
  <strong>Note</strong>: Read more about migrations in the [Truffle documentation](/docs/getting_started/migrations).
</p>

<p>To create our own migration script.</p>
<ol>
<li><p>Create a new file named <code>2_deploy_contracts.js</code> in the <code>migrations/</code> directory.</p>
</li>
<li><p>Add the following content to the <code>2_deploy_contracts.js</code> file:</p>
<pre><code class="language-javascript">const MyStringStore = artifacts.require(&quot;MyStringStore&quot;);

module.exports = function(deployer) {
  deployer.deploy(MyStringStore);
};</code></pre>
</li>
<li><p>Back in our Truffle Develop console, migrate the contract to the blockchain.</p>
<pre><code class="language-shell">migrate</code></pre>
<p>You should see the migrations being executed in order, with the details of each migration listed.</p>
</li>
</ol>

    <h2 class="link-markdown">
      <a class="anchor-target" name="testing-the-smart-contract"></a>
      <a href="#testing-the-smart-contract"><i class="fas fa-link"></i></a>
      Testing the smart contract
    </h2>
  <p>Before we proceed, we should write a couple tests to ensure that our contract works as expected.</p>
<ol>
<li><p>Create a new file named <code>MyStringStore.js</code> in the <code>test/</code> directory.</p>
</li>
<li><p>Add the following content to the <code>MyStringStore.js</code> file:</p>
<pre><code class="language-javascript">const MyStringStore = artifacts.require(&quot;./MyStringStore.sol&quot;);

contract(&quot;MyStringStore&quot;, accounts =&gt; {
  it(&quot;should store the string &#39;Hey there!&#39;&quot;, async () =&gt; {
    const myStringStore = await MyStringStore.deployed();

    // Set myString to &quot;Hey there!&quot;
    await myStringStore.set(&quot;Hey there!&quot;, { from: accounts[0] });

    // Get myString from public variable getter
    const storedString = await myStringStore.myString.call();

    assert.equal(storedString, &quot;Hey there!&quot;, &quot;The string was not stored&quot;);
  });
});</code></pre>
</li>
</ol>

    <h3 class="link-markdown">
      <a class="anchor-target" name="running-the-tests"></a>
      <a href="#running-the-tests"><i class="fas fa-link"></i></a>
      Running the tests
    </h3>
  <ol>
<li><p>Back in the Truffle Develop console, run the tests:</p>
<pre><code class="language-shell">test</code></pre>
</li>
<li><p>If all the tests pass, you&#39;ll see console output similar to this:</p>
<pre><code>Using network &#39;develop&#39;.

Contract: MyStringStore
  ✓ should store the string &#39;Hey there!&#39; (98ms)

1 passing (116ms)</code></pre></li>
</ol>
<p>Awesome! Now we know that the contract actually works.</p>

    <h2 class="link-markdown">
      <a class="anchor-target" name="creating-our-react-js-project"></a>
      <a href="#creating-our-react-js-project"><i class="fas fa-link"></i></a>
      Creating our React.js project
    </h2>
  <p>Now that we are done with the smart contract, we can write our front-end client with React.js! In order to do this, open another terminal, navigate to your project directory, and simply run this command (if you have NPM version 5.2 or above):</p>
<pre><code class="language-shell">npx create-react-app client</code></pre>
<p><strong>If you have an older version of NPM</strong>, make sure Create-React-App is installed globally as per the instructions in the <a href="#create-react-app">Setting up the development environment</a> section and then run the following:</p>
<pre><code class="language-shell">create-react-app client</code></pre>
<p>This should create a <code>client</code> directory in your Truffle project and bootstrap a barebones React.js project for you to start building your front-end with.</p>

    <h2 class="link-markdown">
      <a class="anchor-target" name="wiring-up-the-front-end-client"></a>
      <a href="#wiring-up-the-front-end-client"><i class="fas fa-link"></i></a>
      Wiring up the front-end client
    </h2>
  <p>Since Create-React-App&#39;s default behavior disallows importing files from outside of the <code>src</code> folder, we need to bring the contracts in our <code>build</code> folder inside <code>src</code>. We can copy and paste them every time we compile our contracts, but a better way is to simply configure Truffle to put the files there.</p>
<p>In the <code>truffle-config.js</code> file, replace the contents with the following:</p>
<pre><code class="language-javascript">const path = require(&quot;path&quot;);

module.exports = {
  contracts_build_directory: path.join(__dirname, &quot;client/src/contracts&quot;)
};</code></pre>
<p>This will make sure to output the contract build artifacts directory inside your React project. But this also means we&#39;ll have to restart our Truffle Develop console. Press <code>CTRL + C</code> to exit out of the Truffle Develop console and then start it again with <code>truffle develop</code>.</p>
<p>From there, make sure you run the <code>compile</code> and <code>migrate</code> commands again so that the new build artifacts will be output into the new folder. If you are encountering issues, try <code>migrate --reset</code> for a clean migration from scratch.</p>

    <h3 class="link-markdown">
      <a class="anchor-target" name="install-drizzle"></a>
      <a href="#install-drizzle"><i class="fas fa-link"></i></a>
      Install Drizzle
    </h3>
  <p>This is the most delicious part, we install Drizzle. Make sure you are in the <code>client</code> directory and then run the following:</p>
<pre><code class="language-shell">npm install @drizzle/store</code></pre>
<p>And that&#39;s it for dependencies! Note that we don&#39;t need to install Web3.js or @truffle/contract ourselves. Drizzle contains everything we need to work reactively with our smart contracts.</p>

    <h2 class="link-markdown">
      <a class="anchor-target" name="wire-up-the-react-app-with-drizzle"></a>
      <a href="#wire-up-the-react-app-with-drizzle"><i class="fas fa-link"></i></a>
      Wire up the React app with Drizzle
    </h2>
  <p>Before we go further, let&#39;s start our React app by running the follow command inside our <code>client</code> directory:</p>
<pre><code class="language-shell">npm start</code></pre>
<p>This will serve the front-end under <code>localhost:3000</code>, so open that up in your browser.</p>
<p class="alert alert-info">
<strong>Note</strong>: Make sure to use an incognito window if you already have MetaMask installed (or disable MetaMask for now). Otherwise, the app will try to use the network specified in MetaMask rather than the develop network under `localhost:9545`.
</p>

<p>If the default Create-React-App page loaded without any issues, you may proceed.</p>

    <h3 class="link-markdown">
      <a class="anchor-target" name="setup-the-store"></a>
      <a href="#setup-the-store"><i class="fas fa-link"></i></a>
      Setup the store
    </h3>
  <p>The first thing we need to do is to setup and instantiate the Drizzle store. We are going add the following code to <code>client/src/index.js</code>:</p>
<pre><code class="language-javascript">// import drizzle functions and contract artifact
import { Drizzle } from &quot;@drizzle/store&quot;;
import MyStringStore from &quot;./contracts/MyStringStore.json&quot;;

// let drizzle know what contracts we want and how to access our test blockchain
const options = {
  contracts: [MyStringStore],
  web3: {
    fallback: {
      type: &quot;ws&quot;,
      url: &quot;ws://127.0.0.1:9545&quot;,
    },
  },
};

// setup drizzle
const drizzle = new Drizzle(options);</code></pre>
<p>First, we imported the tools from Drizzle as well as the contract definition.</p>
<p>We then built our options object for Drizzle, which in this case is just specifying the specific contract we want to be loaded by passing in the JSON build artifact.</p>
<p>And finally, we created the <code>drizzleStore</code> and used that to create our <code>drizzle</code> instance which we will pass in as a prop to our <code>App</code> component.</p>
<p>Once that is complete, your <code>index.js</code> should look something like this:</p>
<pre><code class="language-javascript">import React from &#39;react&#39;;
import ReactDOM from &#39;react-dom&#39;;
import &#39;./index.css&#39;;
import App from &#39;./App&#39;;
import * as serviceWorker from &#39;./serviceWorker&#39;;

// import drizzle functions and contract artifact
import { Drizzle, generateStore } from &quot;@drizzle/store&quot;;
import MyStringStore from &quot;./contracts/MyStringStore.json&quot;;

// let drizzle know what contracts we want and how to access our test blockchain
const options = {
  contracts: [MyStringStore],
  web3: {
    fallback: {
      type: &quot;ws&quot;,
      url: &quot;ws://127.0.0.1:9545&quot;,
    },
  },
};

// setup the drizzle store and drizzle
const drizzle = new Drizzle(options);

ReactDOM.render(&lt;App drizzle={drizzle} /&gt;, document.getElementById(&#39;root&#39;));</code></pre>
<p>Note again that the <code>drizzle</code> instance is passed into the <code>App</code> component as props.</p>

    <h3 class="link-markdown">
      <a class="anchor-target" name="wire-up-the-app-component"></a>
      <a href="#wire-up-the-app-component"><i class="fas fa-link"></i></a>
      Wire up the App component
    </h3>
  <p>Now that we have a <code>drizzle</code> instance to play around with, we can go into <code>client/src/App.js</code> to start working with the React API.</p>

    <h4 class="link-markdown">
      <a class="anchor-target" name="adding-state-variables"></a>
      <a href="#adding-state-variables"><i class="fas fa-link"></i></a>
      Adding state variables
    </h4>
  <p>First thing we will do is to add the following line inside our App component:</p>
<pre><code class="language-javascript">state = { loading: true, drizzleState: null };</code></pre>
<p>We are going to be using two state variables here:</p>
<ol>
<li><code>loading</code> — Indicates if Drizzle has finished initializing and the app is ready. The initialization process includes instantiating <code>web3</code> and our smart contracts, fetching any available Ethereum accounts and listening (or, in cases where subscriptions are not supported: polling) for new blocks.</li>
<li><code>drizzleState</code> — This is where we will store the state of the Drizzle store in our top-level component. If we can keep this state variable up-to-date, then we can simply use simple <code>props</code> and <code>state</code> to work with Drizzle (i.e. you don&#39;t have to use any Redux or advanced React patterns).</li>
</ol>

    <h4 class="link-markdown">
      <a class="anchor-target" name="adding-some-initialization-logic"></a>
      <a href="#adding-some-initialization-logic"><i class="fas fa-link"></i></a>
      Adding some initialization logic
    </h4>
  <p>Next we will add in our <code>componentDidMount</code> method into the component class so that we can run some initialization logic.</p>
<pre><code class="language-javascript">componentDidMount() {
  const { drizzle } = this.props;

  // subscribe to changes in the store
  this.unsubscribe = drizzle.store.subscribe(() =&gt; {

    // every time the store updates, grab the state from drizzle
    const drizzleState = drizzle.store.getState();

    // check to see if it&#39;s ready, if so, update local component state
    if (drizzleState.drizzleStatus.initialized) {
      this.setState({ loading: false, drizzleState });
    }
  });
}</code></pre>
<p>First, we grab the <code>drizzle</code> instance from the props, then we call <code>drizzle.store.subscribe</code> and pass in a callback function. This callback function is called whenever the Drizzle store is updated. Note that this store is actually a Redux store under the hood, so this might look familiar if you&#39;ve used Redux previously.</p>
<p>Whenever the store is updated, we will try to grab the state with <code>drizzle.store.getState()</code> and then if Drizzle is initialized and ready, we will set <code>loading</code> to false, and also update the <code>drizzleState</code> state variable.</p>
<p>By doing this, <code>drizzleState</code> will always be up-to-date and we also know exactly when Drizzle is ready so we can use a loading component to let the user know.</p>

    <h5 class="link-markdown">
      <a class="anchor-target" name="unsubscribing-from-the-store"></a>
      <a href="#unsubscribing-from-the-store"><i class="fas fa-link"></i></a>
      Unsubscribing from the store
    </h5>
  <p>Note that we assign the return value of the <code>subscribe()</code> to a class variable <code>this.unsubscribe</code>. This is because it is always good practice to unsubscribe from any subscriptions you have when the component un-mounts. In order to do this, we save a reference to that subscription (i.e. <code>this.unsubscribe</code>), and inside <code>componentWillUnmount</code>, we have the following:</p>
<pre><code class="language-javascript">componentWillUnmount() {
  this.unsubscribe();
}</code></pre>
<p>This will safely unsubscribe when the App component un-mounts so we can prevent any memory leaks.</p>

    <h4 class="link-markdown">
      <a class="anchor-target" name="replace-the-code-render-code-method"></a>
      <a href="#replace-the-code-render-code-method"><i class="fas fa-link"></i></a>
      Replace the <code>render</code> method
    </h4>
  <p>Finally, we can replace the boilerplate render method with something that applies to us better:</p>
<pre><code class="language-javascript">render() {
  if (this.state.loading) return &quot;Loading Drizzle...&quot;;
  return &lt;div className=&quot;App&quot;&gt;Drizzle is ready&lt;/div&gt;;
}</code></pre>
<p>In the next section, we will replace &quot;Drizzle is ready&quot; with an actual component that will read from the store. If you refresh your browser and run this app now, you should see &quot;Loading Drizzle...&quot; briefly flash on screen and then subsequently &quot;Drizzle is ready&quot;.</p>

    <h3 class="link-markdown">
      <a class="anchor-target" name="full-component-code"></a>
      <a href="#full-component-code"><i class="fas fa-link"></i></a>
      Full component code
    </h3>
  <p>When you are done this section, your <code>App</code> component should look like the following:</p>
<pre><code class="language-javascript">class App extends Component {
  state = { loading: true, drizzleState: null };

  componentDidMount() {
    const { drizzle } = this.props;

    // subscribe to changes in the store
    this.unsubscribe = drizzle.store.subscribe(() =&gt; {

      // every time the store updates, grab the state from drizzle
      const drizzleState = drizzle.store.getState();

      // check to see if it&#39;s ready, if so, update local component state
      if (drizzleState.drizzleStatus.initialized) {
        this.setState({ loading: false, drizzleState });
      }
    });
  }

  componentWillUnmount() {
    this.unsubscribe();
  }

  render() {
    if (this.state.loading) return &quot;Loading Drizzle...&quot;;
    return &lt;div className=&quot;App&quot;&gt;Drizzle is ready&lt;/div&gt;;
  }
}</code></pre>

    <h2 class="link-markdown">
      <a class="anchor-target" name="write-a-component-to-read-from-drizzle"></a>
      <a href="#write-a-component-to-read-from-drizzle"><i class="fas fa-link"></i></a>
      Write a component to read from Drizzle
    </h2>
  <p>First, let&#39;s create a new file at <code>client/src/ReadString.js</code> and paste in the following:</p>
<pre><code class="language-javascript">import React from &quot;react&quot;;

class ReadString extends React.Component {
  componentDidMount() {
    const { drizzle, drizzleState } = this.props;
    console.log(drizzle);
    console.log(drizzleState);
  }

  render() {
    return &lt;div&gt;ReadString Component&lt;/div&gt;;
  }
}

export default ReadString;</code></pre>
<p>And then inside <code>App.js</code>, import the new component with this statement:</p>
<pre><code class="language-javascript">import ReadString from &quot;./ReadString&quot;;</code></pre>
<p>Now modify your <code>App.js</code> render method so that we pass in the <code>drizzle</code> instance from props as well as the <code>drizzleState</code> from the component state:</p>
<pre><code class="language-javascript">render() {
  if (this.state.loading) return &quot;Loading Drizzle...&quot;;
  return (
    &lt;div className=&quot;App&quot;&gt;
      &lt;ReadString
        drizzle={this.props.drizzle}
        drizzleState={this.state.drizzleState}
      /&gt;
    &lt;/div&gt;
  );
}</code></pre>
<p>Go back to the browser and open up your console. You should see that the two <code>console.log</code> statements are working and they are displaying both the <code>drizzle</code> instance as well as a <code>drizzleState</code> that is fully initialized.</p>
<p>What this tells us is that the <code>drizzleState</code> we get in this component will always be fully ready once this component mounts. At this point, you can take some time to explore the <code>drizzle</code> instance object as well as the <code>drizzleState</code> object.</p>

    <h3 class="link-markdown">
      <a class="anchor-target" name="-code-drizzle-code-instance-and-code-drizzlestate-code-"></a>
      <a href="#-code-drizzle-code-instance-and-code-drizzlestate-code-"><i class="fas fa-link"></i></a>
      <code>drizzle</code> instance and <code>drizzleState</code>
    </h3>
  <p>For the most part, <code>drizzleState</code> is there for you to read information from (i.e. contract state variables, return values, transaction status, account data, etc.), whereas the <code>drizzle</code> instance is what you will use to actually get stuff done (i.e. call contract methods, the Web3 instance, etc.).</p>

    <h3 class="link-markdown">
      <a class="anchor-target" name="wiring-up-the-code-readstring-code-component"></a>
      <a href="#wiring-up-the-code-readstring-code-component"><i class="fas fa-link"></i></a>
      Wiring up the <code>ReadString</code> component
    </h3>
  <p>Now that we have access to our <code>drizzle</code> instance and the <code>drizzleState</code>, we can put in the logic that allows us read the smart contract variable we are interested in. Here is what the full code of <code>ReadString.js</code> should look like:</p>
<pre><code class="language-javascript">import React from &quot;react&quot;;

class ReadString extends React.Component {
  state = { dataKey: null };

  componentDidMount() {
    const { drizzle } = this.props;
    const contract = drizzle.contracts.MyStringStore;

    // let drizzle know we want to watch the `myString` method
    const dataKey = contract.methods[&quot;myString&quot;].cacheCall();

    // save the `dataKey` to local component state for later reference
    this.setState({ dataKey });
  }

  render() {
    // get the contract state from drizzleState
    const { MyStringStore } = this.props.drizzleState.contracts;

    // using the saved `dataKey`, get the variable we&#39;re interested in
    const myString = MyStringStore.myString[this.state.dataKey];

    // if it exists, then we display its value
    return &lt;p&gt;My stored string: {myString &amp;&amp; myString.value}&lt;/p&gt;;
  }
}

export default ReadString;</code></pre>
<p>If everything is working, your app should display &quot;Hello World&quot;. But first, let&#39;s walk through what we did here.</p>

    <h4 class="link-markdown">
      <a class="anchor-target" name="when-the-component-mounts"></a>
      <a href="#when-the-component-mounts"><i class="fas fa-link"></i></a>
      When the component mounts
    </h4>
  <pre><code class="language-javascript">componentDidMount() {
  const { drizzle } = this.props;
  const contract = drizzle.contracts.MyStringStore;

  // let drizzle know we want to watch the `myString` method
  const dataKey = contract.methods[&quot;myString&quot;].cacheCall();

  // save the `dataKey` to local component state for later reference
  this.setState({ dataKey });
}</code></pre>
<p>When the component mounts, we first grab a reference to the contract we are interested in and assign it to <code>contract</code>.</p>
<p>We then need to tell Drizzle to keep track of a variable we are interested in. In order to do that, we call the <code>.cacheCall()</code> function on the <code>myString</code> getter method.</p>
<p>What we get in return is a <code>dataKey</code> that allows us to reference this variable. We save this to the component&#39;s state so we can use it later.</p>

    <h4 class="link-markdown">
      <a class="anchor-target" name="the-code-render-code-method"></a>
      <a href="#the-code-render-code-method"><i class="fas fa-link"></i></a>
      The <code>render</code> method
    </h4>
  <pre><code class="language-javascript">render() {
  // get the contract state from drizzleState
  const { MyStringStore } = this.props.drizzleState.contracts;

  // using the saved `dataKey`, get the variable we&#39;re interested in
  const myString = MyStringStore.myString[this.state.dataKey];

  // if it exists, then we display its value
  return &lt;p&gt;My stored string: {myString &amp;&amp; myString.value}&lt;/p&gt;;
}</code></pre>
<p>From the <code>drizzleState</code>, we grab the slice of the state we are interested in, which in this case is the <code>MyStringStore</code> contract. From there, we use the <code>dataKey</code> we saved from before in order to access the <code>myString</code> variable.</p>
<p>Finally, we write <code>myString &amp;&amp; myString.value</code> to show the value of the variable if it exists, or nothing otherwise. And in this case, it should show &quot;Hello World&quot; since that is the string the contract is initialized with.</p>

    <h3 class="link-markdown">
      <a class="anchor-target" name="quick-recap"></a>
      <a href="#quick-recap"><i class="fas fa-link"></i></a>
      Quick Recap
    </h3>
  <p>The most important thing to get out of this section here is that there are two steps to reading a value with Drizzle:</p>
<ol>
<li>First, you need to let Drizzle know what variable you want to watch for. Drizzle will give you a <code>dataKey</code> in return and you need to save it for later reference.</li>
<li>Second, due to the asynchronous nature of how Drizzle works, you should be watching for changes in <code>drizzleState</code>. Once the variable accessed by the <code>dataKey</code> exists, you will be able to get the value you are interested in.</li>
</ol>

    <h2 class="link-markdown">
      <a class="anchor-target" name="write-a-component-to-write-to-the-smart-contract"></a>
      <a href="#write-a-component-to-write-to-the-smart-contract"><i class="fas fa-link"></i></a>
      Write a component to write to the smart contract
    </h2>
  <p>Of course, simply reading a pre-initialized variable is no fun at all; we want something that we can interact with. In this section, we will create an input box where you can type a string of your choice and have it save to the blockchain forever!</p>
<p>First, let&#39;s create a new file <code>client/src/SetString.js</code> and paste in the following:</p>
<pre><code class="language-javascript">import React from &quot;react&quot;;

class SetString extends React.Component {
  state = { stackId: null };

  handleKeyDown = e =&gt; {
    // if the enter key is pressed, set the value with the string
    if (e.keyCode === 13) {
      this.setValue(e.target.value);
    }
  };

  setValue = value =&gt; {
    const { drizzle, drizzleState } = this.props;
    const contract = drizzle.contracts.MyStringStore;

    // let drizzle know we want to call the `set` method with `value`
    const stackId = contract.methods[&quot;set&quot;].cacheSend(value, {
      from: drizzleState.accounts[0]
    });

    // save the `stackId` for later reference
    this.setState({ stackId });
  };

  getTxStatus = () =&gt; {
    // get the transaction states from the drizzle state
    const { transactions, transactionStack } = this.props.drizzleState;

    // get the transaction hash using our saved `stackId`
    const txHash = transactionStack[this.state.stackId];

    // if transaction hash does not exist, don&#39;t display anything
    if (!txHash) return null;

    // otherwise, return the transaction status
    return `Transaction status: ${transactions[txHash] &amp;&amp; transactions[txHash].status}`;
  };

  render() {
    return (
      &lt;div&gt;
        &lt;input type=&quot;text&quot; onKeyDown={this.handleKeyDown} /&gt;
        &lt;div&gt;{this.getTxStatus()}&lt;/div&gt;
      &lt;/div&gt;
    );
  }
}

export default SetString;</code></pre>
<p>At this point, import and include it inside <code>App.js</code> just like you did with the <code>ReadString</code> component:</p>
<pre><code class="language-javascript">import SetString from &quot;./SetString&quot;;

// ...

  render() {
    if (this.state.loading) return &quot;Loading Drizzle...&quot;;
    return (
      &lt;div className=&quot;App&quot;&gt;
        &lt;ReadString
          drizzle={this.props.drizzle}
          drizzleState={this.state.drizzleState}
        /&gt;
        &lt;SetString
          drizzle={this.props.drizzle}
          drizzleState={this.state.drizzleState}
        /&gt;
      &lt;/div&gt;
    );
  }</code></pre>
<p>At this point, the app should work and you should try it out. You should be able to type something into the input text box, hit Enter, and Drizzle&#39;s react store will automatically display the new string.</p>
<p>Next, let&#39;s go through <code>SetString.js</code> step-by-step.</p>

    <h3 class="link-markdown">
      <a class="anchor-target" name="general-structure"></a>
      <a href="#general-structure"><i class="fas fa-link"></i></a>
      General structure
    </h3>
  <p>First let&#39;s take a look at the general React.js boilerplate that we need.</p>
<pre><code class="language-javascript">class SetString extends React.Component {
  state = { stackId: null };

  handleKeyDown = e =&gt; {
    // if the enter key is pressed, set the value with the string
    if (e.keyCode === 13) {
      this.setValue(e.target.value);
    }
  };

  setValue = value =&gt; { ... };

  getTxStatus = () =&gt; { ... };

  render() {
    return (
      &lt;div&gt;
        &lt;input type=&quot;text&quot; onKeyDown={this.handleKeyDown} /&gt;
        &lt;div&gt;{this.getTxStatus()}&lt;/div&gt;
      &lt;/div&gt;
    );
  }
}</code></pre>
<p>In this component, we will have an input text box for the user to type in a string, and when the Enter key is pressed, the <code>setValue</code> method will be called with the string as a parameter.</p>
<p>Also, we will display the status of the transaction. The <code>getTxStatus</code> method will return a string displaying the status of the transaction by referencing a <code>stackId</code> state variable (more on this later).</p>

    <h3 class="link-markdown">
      <a class="anchor-target" name="submitting-the-transaction"></a>
      <a href="#submitting-the-transaction"><i class="fas fa-link"></i></a>
      Submitting the transaction
    </h3>
  <pre><code class="language-javascript">setValue = value =&gt; {
  const { drizzle, drizzleState } = this.props;
  const contract = drizzle.contracts.MyStringStore;

  // let drizzle know we want to call the `set` method with `value`
  const stackId = contract.methods[&quot;set&quot;].cacheSend(value, {
    from: drizzleState.accounts[0]
  });

  // save the `stackId` for later reference
  this.setState({ stackId });
};</code></pre>
<p>We first assign the contract from the <code>drizzle</code> instance into <code>contract</code>, and then we call <code>cacheSend()</code> on the method we are interested in (i.e. <code>set</code>). Then we pass in the string we want to set (i.e. <code>value</code>) as well as our transaction options (in this case, just the <code>from</code> field). Note that we can get our current account address from <code>drizzleState.accounts[0]</code>.</p>
<p>What we get in return is a <code>stackId</code>, which is a reference to the transaction that we want to execute. Ethereum transactions don&#39;t receive a hash until they&#39;re broadcast to the network. In case an error occurs before broadcast, Drizzle keeps track of these transactions by giving each it&#39;s own ID. Once successfully broadcasted, the <code>stackId</code> will point to the transaction hash, so we save it in our local component state for later usage.</p>

    <h3 class="link-markdown">
      <a class="anchor-target" name="tracking-transaction-status"></a>
      <a href="#tracking-transaction-status"><i class="fas fa-link"></i></a>
      Tracking transaction status
    </h3>
  <pre><code class="language-javascript">getTxStatus = () =&gt; {
  // get the transaction states from the drizzle state
  const { transactions, transactionStack } = this.props.drizzleState;

  // get the transaction hash using our saved `stackId`
  const txHash = transactionStack[this.state.stackId];

  // if transaction hash does not exist, don&#39;t display anything
  if (!txHash) return null;

  // otherwise, return the transaction status
  return `Transaction status: ${transactions[txHash] &amp;&amp; transactions[txHash].status}`;
};</code></pre>
<p>Now that we have a <code>stackId</code> saved into our local component state, we can use this to check the status of our transaction. First, we need the <code>transactions</code> and <code>transactionStack</code> slices of state from <code>drizzleState</code>.</p>
<p>Then, we can get the transaction hash (assigned to <code>txHash</code>) via <code>transactionStack[stackId]</code>. If the hash does not exist, then we know that the transaction has not been broadcasted yet and we return null.</p>
<p>Otherwise, we display a string to show the status of our transaction. Usually, this will either be &quot;pending&quot; or &quot;success&quot;.</p>

    <h1 class="link-markdown">
      <a class="anchor-target" name="the-end"></a>
      <a href="#the-end"><i class="fas fa-link"></i></a>
      The End
    </h1>
  <p>Congratulations! You have taken a huge step to understanding how Drizzle works. Of course, this is only the beginning, you can use tools like <a href="https://github.com/trufflesuite/drizzle-react"><code>drizzle-react</code></a> to help you integrate Drizzle into your dapp, reducing the necessary boilerplate that you would have to write.</p>
<p>Alternatively, you could also bootstrap your Drizzle dapp with our <a href="https://github.com/truffle-box/drizzle-box">Truffle box</a>.</p>


          <div class="contribute-link">
            See a way to make this page better? <a href="https://github.com/trufflesuite/trufflesuite.com/edit/develop/src/guides">Edit here &raquo;</a>
          </div>        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div class="row">
        <div class="col-12 col-md-2 mb-4 mb-md-0">
          <img class="truffle-logo" src="/img/truffle-logo-light.svg" alt="Truffle Logo" />
        </div>
  
        <div class="col-12 col-md-5 mb-3 mb-md-0">
          <ul>
            <li><a href="mailto:inquiry@trufflesuite.com">CONTACT US</a></li>
            <li><a href="/policy">PRIVACY POLICY</a></li>
            <li><a href="/press-releases">PRESS RELEASES</a></li>
            <li><a href="/staff">STAFF</a></li>
            <li><a href="/dashboard">DASHBOARD</a></li>
            <li><a href="https://github.com/trufflesuite">GITHUB</a></li>
            <li><a class="trufflecon-link" href="https://www.trufflesuite.com/trufflecon2020">TRUFFLEC<img src="/img/truffle-logomark.svg" alt="Truffle Logo" /><span>O</span>N 2020</a></li>
            <li><strong>&copy; ConsenSys Software Inc. 2021</strong></li>
          </ul>
  
          <ul class="list-inline h4 ">
            <li class="list-inline-item mb-0"><a href="https://www.reddit.com/r/truffle"><i class="fab fa-reddit-square"></i></a></li>
            <li class="list-inline-item mb-0"><a href="https://twitter.com/trufflesuite"><i class="fab fa-twitter-square"></i></a></li>
            <li class="list-inline-item mb-0"><a href="https://www.facebook.com/trufflesuite/"><i class="fab fa-facebook-square"></i></a></li>
            <li class="list-inline-item mb-0"><a href="https://www.instagram.com/truffledevsuite/"><i class="fab fa-instagram"></i></a></li>
            <li class="list-inline-item mb-0"><a href="https://www.linkedin.com/company/trufflesuite/"><i class="fab fa-linkedin"></i></a></li>
            <li class="list-inline-item mb-0"><a href="https://www.youtube.com/channel/UCo2cy2Z7_91zPJSrb6NWfSw"><i class="fab fa-youtube-square"></i></a></li>
          </ul>
        </div>
  
        <div class="col-12 col-md-5">
          <h4>SIGN UP FOR THE TRUFFLE MAILING LIST</h4>
          <!--[if lte IE 8]>
            <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
          <![endif]-->
          <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>
          <script>
            hbspt.forms.create({
              portalId: "4795067",
              formId: "d18995c8-32bb-4b2d-bde9-3f49fb3d2837"
            });
          </script>
        </div>
      </div>
    </div>
  </footer>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script>window.jQuery || document.write('<script src="/js/vendor/jquery-3.2.1.slim.min.js"><\/script>')</script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/vendor/prism.js"></script>
  <script src="/js/markdown-cleanup.js"></script>
</body>
</html>